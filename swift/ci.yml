.only_swift:
  needs: []
  rules:
    - changes:
        - swift/**/*
    - if: '$CI_COMMIT_TAG =~ /^v[0-9]+.[0-9]+.[0-9]+-(alpha|beta|rc)\.[0-9]+$/'
    - if: '$CI_COMMIT_REF_NAME == "master"'
    - if: '$CI_COMMIT_REF_NAME == "develop"'
    - if: '$CI_COMMIT_REF_PROTECTED == "true"'

.only_deploy:
  rules:
    - if: '$CI_COMMIT_TAG =~ /^v[0-9]+.[0-9]+.[0-9]+(\-RC[0-9]+)?$/'
      when: manual



swift:
  stage: bindings
  needs: []
  tags:
    - mac-os
  script:
    - mkdir build
    - cd build
    - MACOSX_DEPLOYMENT_TARGET=10.15 cmake -DCMAKE_BUILD_TYPE=release -DTRANSPORTS=false -DUSE_CURL=false  -DCMD=false .. && make && rm -f lib/libin3.dylib
    - cd ../swift
    - swift build
    - swift test 2> output
    - cat output
    - ../scripts/create_swift_junit.js < output >swift.xml
  artifacts:
    reports:
      junit: swift/swift.xml
    paths:
      - swift/.build
