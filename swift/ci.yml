.only_swift:
  needs: []
  rules:
    - changes:
        - swift/**/*
    - if: '$CI_COMMIT_TAG =~ /^v[0-9]+.[0-9]+.[0-9]+-(alpha|beta|rc)\.[0-9]+$/'
    - if: '$CI_COMMIT_REF_NAME == "master"'
    - if: '$CI_COMMIT_REF_NAME == "develop"'
    - if: '$CI_COMMIT_REF_PROTECTED == "true"'

.only_deploy:
  rules:
    - if: '$CI_COMMIT_TAG =~ /^v[0-9]+.[0-9]+.[0-9]+(\-RC[0-9]+)?$/'
      when: manual



swift:
  stage: bindings
  needs: []
  tags:
    - mac-os
  script:
    - mkdir build
    - cd build
    - cmake -DCMAKE_BUILD_TYPE=release -DCMD=false .. && make
    - cd ../swift/In3
    - swift build -Xlinker -L../../build/lib
    - swift test -Xlinker -L../../build/lib
  artifacts:
    paths:
      - swift/In3/.build
